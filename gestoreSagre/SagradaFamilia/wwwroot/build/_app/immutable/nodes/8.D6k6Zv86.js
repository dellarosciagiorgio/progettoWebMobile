import{t as y,a as _}from"../chunks/C3LzQ5sL.js";import"../chunks/Cf1npzb8.js";import{p as Z,a as ee,s as u,m as b,a0 as p,e as i,a2 as v,a1 as m,n as A,a3 as q}from"../chunks/TWVgqK11.js";import{i as D,s as H,e as te}from"../chunks/BZQWxGEs.js";import{r as O}from"../chunks/BS78Nl50.js";import{b as J,a as oe,p as se}from"../chunks/CQv9zxpj.js";import{i as ae}from"../chunks/B6UNWQNk.js";import{o as ie}from"../chunks/8FTZ2a1S.js";/* empty css                */import{i as P,u as G,r as Q}from"../chunks/Bm-Gevi7.js";class S extends Error{}S.prototype.name="InvalidTokenError";function re(c){return decodeURIComponent(atob(c).replace(/(.)/g,(l,a)=>{let d=a.charCodeAt(0).toString(16).toUpperCase();return d.length<2&&(d="0"+d),"%"+d}))}function ne(c){let l=c.replace(/-/g,"+").replace(/_/g,"/");switch(l.length%4){case 0:break;case 2:l+="==";break;case 3:l+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return re(l)}catch{return atob(l)}}function le(c,l){if(typeof c!="string")throw new S("Invalid token specified: must be a string");l||(l={});const a=l.header===!0?0:1,d=c.split(".")[a];if(typeof d!="string")throw new S(`Invalid token specified: missing part #${a+1}`);let h;try{h=ne(d)}catch(g){throw new S(`Invalid token specified: invalid base64 for part #${a+1} (${g.message})`)}try{return JSON.parse(h)}catch(g){throw new S(`Invalid token specified: invalid json for part #${a+1} (${g.message})`)}}var ce=y('<div class="alert-error"> </div>'),de=y('<span class="spinner"></span>'),ue=y('<div class="login-card"><div class="login-header"><h1>Sagre Online</h1> <p>Gestione Eventi e Sagre</p></div> <div class="login-body"><div class="logo-container"><img src="/logo.png" alt="Logo" class="img-fluid logo-image"></div> <h2>Accedi</h2> <p class="subtitle">Inserisci le tue credenziali per accedere</p> <!> <form><div class="form-group"><input type="email" id="email" placeholder="Email" required></div> <div class="form-group"><input type="password" id="password" placeholder="Password" required></div> <div class="remember-me"><label class="checkbox-container">Ricordami <input type="checkbox"> <span class="checkmark"></span></label></div> <button type="submit" class="login-button"><!> </button></form> <div class="divider"><div class="divider-line"></div> <span class="divider-text">oppure</span> <div class="divider-line"></div></div> <div class="register-section"><p>Non hai un account?</p> <a href="/Registrazione" class="register-link">Registrati</a></div></div> <div class="login-footer"><p>Â© 2024 Sagre Online - Tutti i diritti riservati</p></div></div>'),pe=y(`<div class="success-card"><div class="success-logo-container"><div class="success-logo-circle"></div> <img src="/logo.png" alt="Logo" class="img-fluid logo-image"></div> <h2 class="success-title">Accesso Effettuato</h2> <p class="success-subtitle">Hai effettuato l'accesso con successo. Sarai reindirizzato automaticamente.</p></div>`),ve=y('<div class="login-container"><!></div>');function ge(c,l){Z(l,!1);let a=b(""),d=b(""),h=b(!1),g=b(!1),E=b(""),k=b(!1);function x(s,e,o){let r="";if(o){const t=new Date;t.setTime(t.getTime()+o*24*60*60*1e3),r="; expires="+t.toUTCString()}document.cookie=s+"="+(e||"")+r+"; path=/; Secure; SameSite=Strict",console.log(`Cookie set: ${s}`),console.log(`Document cookie: ${document.cookie}`)}function T(s){const e=s+"=",o=document.cookie.split(";");for(let r=0;r<o.length;r++){let t=o[r];for(;t.charAt(0)==" ";)t=t.substring(1,t.length);if(t.indexOf(e)==0)return t.substring(e.length,t.length)}return null}const B=async()=>{u(k,!0),u(g,!1),u(E,"");const s="login";try{const e=await fetch(`https://localhost:443/api/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:i(a),password:i(d)})}),o=await e.json();if(!e.ok)throw new Error(o.message||"Login fallito: Status "+e.status);if(console.log("Login avvenuto con successo:",o),o.success&&o.data){const r=o.data;console.log(r);const t=le(r);console.log(t);const f=i(h)?30:1;x("authToken",r,f),x("userEmail",t.Email,f),x("userRole",t.Ruolo,f),P.set(!0),G.set(i(a)),Q.set(t.Ruolo),localStorage.setItem("authStatus","true"),localStorage.setItem("userEmail",i(a)),localStorage.setItem("userRole",t.Ruolo),u(g,!0),setTimeout(()=>{window.location.href="/Home"},2e3)}else throw new Error("Login response received, but token data is missing.")}catch(e){console.error("Errore durante il login:",e),u(E,e.message||"Credenziali non valide o errore di connessione")}finally{u(k,!1)}};ie(()=>{const s=T("authToken"),e=T("userEmail"),o=T("userRole");s&&(console.log("User already has a token"),u(g,!0),P.set(!0),e&&(G.set(e),u(a,e)),o&&Q.set(o))}),ae();var I=ve(),F=p(I);{var K=s=>{var e=ue(),o=m(p(e),2),r=m(p(o),6);{var t=n=>{var w=ce(),Y=p(w,!0);v(w),q(()=>H(Y,i(E))),_(n,w)};D(r,n=>{i(E)&&n(t)})}var f=m(r,2),R=p(f),U=p(R);O(U),v(R);var C=m(R,2),j=p(C);O(j),v(C);var L=m(C,2),z=p(L),M=m(p(z));O(M),A(2),v(z),v(L);var $=m(L,2),N=p($);{var W=n=>{var w=de();_(n,w)};D(N,n=>{i(k)&&n(W)})}var X=m(N);v($),v(f),A(4),v(o),A(2),v(e),q(()=>{$.disabled=i(k),H(X,` ${i(k)?"Accesso in corso...":"Accedi"}`)}),J(U,()=>i(a),n=>u(a,n)),J(j,()=>i(d),n=>u(d,n)),oe(M,()=>i(h),n=>u(h,n)),te("submit",f,se(B)),_(s,e)},V=s=>{var e=pe();_(s,e)};D(F,s=>{i(g)?s(V,!1):s(K)})}v(I),_(c,I),ee()}function xe(c){ge(c,{})}export{xe as component};
