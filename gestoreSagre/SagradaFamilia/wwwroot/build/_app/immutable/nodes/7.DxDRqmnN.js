import{t as z,a as S}from"../chunks/C3LzQ5sL.js";import"../chunks/Cf1npzb8.js";import{p as ya,a6 as Sa,a as za,a1 as l,a0 as i,a7 as Ea,a2 as r,e as o,m as E,s as d,a3 as G,n as Q,a8 as M}from"../chunks/TWVgqK11.js";import{h as xa,i as $,e as p,s as q,r as R}from"../chunks/BZQWxGEs.js";import{e as ka,i as Aa}from"../chunks/B7YXE8lP.js";import{r as ea}from"../chunks/BS78Nl50.js";import{b as J,p as oa}from"../chunks/CQv9zxpj.js";import{i as Na}from"../chunks/B6UNWQNk.js";import{o as Da}from"../chunks/8FTZ2a1S.js";/* empty css                */var ja=z('<div class="alert alert-danger"> </div>'),Oa=z('<div class="d-flex justify-content-center mt-5"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Caricamento...</span></div></div>'),Ma=z('<div class="alert alert-info">Non hai ancora creato nessuna sagra. Clicca su "Aggiungi Sagra" per iniziare.</div>'),$a=z('<div class="col"><div class="card h-100 event-card"><img src="/imgs/sagra.jpg" class="card-img-top sagra-image" alt="Immagine della sagra"> <div class="card-body"><h5 class="card-title"> </h5> <p class="card-text description"> </p> <p class="card-text location"><span class="location-prefix">Luogo:</span> </p></div> <div class="card-footer"><div class="d-flex justify-content-between"><button class="btn btn-events">Eventi</button> <div class="action-buttons"><button class="btn btn-edit" title="Modifica sagra"><span class="edit-icon">‚úèÔ∏è</span></button> <button class="btn btn-delete" title="Elimina sagra"><span class="delete-icon">üóëÔ∏è</span></button></div></div></div></div></div>'),Ja=z('<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4"></div>'),La=z('<div class="modal-overlay"><div class="modal-wrapper"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Aggiungi Nuova Sagra</h5> <button type="button" class="btn-close" aria-label="btn-addSagra"></button></div> <div class="modal-body"><form><div class="mb-3"><label for="nome" class="form-label">Nome*</label> <input type="text" class="form-control" id="nome" required></div> <div class="mb-3"><label for="descrizione" class="form-label">Descrizione*</label> <textarea class="form-control" id="descrizione" rows="3" required></textarea></div> <div class="mb-3"><label for="luogo" class="form-label">Luogo*</label> <input type="text" class="form-control" id="luogo" required></div> <div class="modal-footer"><button type="button" class="btn btn-secondary">Annulla</button> <button type="submit" class="btn btn-submit">Salva</button></div></form></div></div></div></div>'),Ta=z('<div class="modal-overlay"><div class="modal-wrapper"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Modifica Sagra</h5> <button type="button" class="btn-close" aria-label="btn-editSagra"></button></div> <div class="modal-body"><form><div class="mb-3"><label for="edit-nome" class="form-label">Nome*</label> <textarea class="form-control" id="edit-nome" rows="3" required></textarea></div> <div class="mb-3"><label for="edit-descrizione" class="form-label">Descrizione*</label> <textarea class="form-control" id="edit-descrizione" rows="3" required></textarea></div> <div class="mb-3"><label for="edit-luogo" class="form-label">Luogo*</label> <textarea class="form-control" id="edit-luogo" rows="3" required></textarea></div> <div class="modal-footer"><button type="button" class="btn btn-secondary">Annulla</button> <button type="submit" class="btn btn-submit">Aggiorna</button></div></form></div></div></div></div>'),Ca=z(`<div class="modal-overlay"><div class="modal-wrapper delete-modal"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Conferma Eliminazione</h5> <button type="button" class="btn-close" aria-label="btn-deleteSagra"></button></div> <div class="modal-body delete-modal-body"><div class="delete-warning-icon"><span class="warning-icon">‚ö†Ô∏è</span></div> <h4 class="delete-title"> </h4> <div class="delete-warning"><p>Questa azione √® <strong>irreversibile</strong> e comporter√†
                            anche l'eliminazione di tutti gli eventi associati.</p> <p>Sei sicuro di voler procedere?</p></div></div> <div class="modal-footer delete-modal-footer"><button type="button" class="btn btn-secondary">Annulla</button> <button type="button" class="btn btn-delete-confirm"><span class="trash-icon">üóëÔ∏è</span> Elimina Sagra</button></div></div></div></div>`),qa=z('<div class="container mt-4"><div class="page-header d-flex justify-content-between align-items-center mb-4"><h1>Le Mie Sagre</h1> <button class="btn btn-add-sagra"><span class="add-icon">+</span> Aggiungi Sagra</button></div> <!> <!></div> <!> <!> <!>',1);function Ra(B,ra){ya(ra,!1);let L=E([]),I=E(!0),x=E(null),T=E(!1),C=E(!1),k=E(!1),A=E(null),c=E({nome:"",descrizione:"",luogo:""});function D(a){const e=a+"=",n=document.cookie.split(";");for(let t=0;t<n.length;t++){let s=n[t];for(;s.charAt(0)==" ";)s=s.substring(1,s.length);if(s.indexOf(e)==0)return s.substring(e.length,s.length)}return null}function ta(a){return a.map(e=>{console.log("Struttura sagra originale:",JSON.stringify(e));const n={idSagra:e.idSagra,nomeSagra:e.nomeSagra,descrizione:e.descrizione,luogo:e.luogo};return console.log("Sagra normalizzata:",JSON.stringify(n)),n})}async function j(){d(I,!0),d(x,null);try{const a=D("authToken");if(!a)throw new Error("Token di autenticazione non trovato");const e=await fetch("https://localhost:443/api/sagre/mySagre",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}}),n=await e.text();if(!n)throw new Error("Il server ha restituito una risposta vuota");console.log("Risposta dal server (raw):",n);let t;try{t=JSON.parse(n)}catch{throw new Error(`Errore nel parsing della risposta: ${n.substring(0,100)}...`)}if(!e.ok)throw new Error(t&&t.message?t.message:`Errore durante il recupero delle sagre: ${e.status}`);console.log("Struttura dati ricevuti:",t);let s=[];t.success===!0&&Array.isArray(t.data)?s=t.data:Array.isArray(t)?s=t:typeof t=="object"&&t!==null&&(s=[t]),d(L,ta(s)),console.log("Sagre normalizzate:",o(L))}catch(a){console.error("Errore nel caricamento delle sagre:",a),d(x,a.message),d(L,[])}finally{d(I,!1)}}async function sa(){try{const a=D("authToken");if(!a)throw new Error("Token di autenticazione non trovato");let e,n,t;if(o(c))e=o(c).nome,n=o(c).descrizione,t=o(c).luogo;else throw new Error("Dati non validi");const v=await fetch("https://localhost:443/api/sagra",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({nomeSagra:e,descrizione:n,luogo:t})});if(!v.ok){let u="Sagra non aggiunta. Status: "+v.status;try{const g=await v.json();g&&g.message&&(u+=" - "+g.message)}catch(g){console.error("Error parsing JSON error response:",g)}throw new Error(u)}const f=await v.json();await j(),d(T,!1),console.log(f)}catch(a){console.error("Errore nell'aggiunta della sagra:",a),d(x,a.message)}}async function ia(a){try{console.log("SAGRA TO UP: ",a);const e=D("authToken");if(!e)throw new Error("Token di autenticazione non trovato");if(console.log("Dati da inviare per aggiornamento:",o(c)),o(c))a.nomeSagra=o(c).nome,a.descrizione=o(c).descrizione,a.luogo=o(c).luogo,console.log("Nome:",a.nomeSagra),console.log("Descrizione:",a.descrizione),console.log("Luogo:",a.luogo);else throw new Error("Dati non validi");const n=await fetch("https://localhost:443/api/sagra",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({idSagra:a.idSagra,nomeSagra:a.nomeSagra,descrizione:a.descrizione,luogo:a.luogo})});if(!n.ok){let s="Sagra non aggiunta. Status: "+n.status;try{const v=await n.json();v&&v.message&&(s+=" - "+v.message)}catch(v){console.error("Error parsing JSON error response:",v)}throw new Error(s)}const t=await n.json();await j(),d(C,!1),console.log(t)}catch(e){console.error("Errore nell'aggiunta della sagra:",e),d(x,e.message)}}async function na(){try{const a=D("authToken");if(!a)throw new Error("Token di autenticazione non trovato");const e=await fetch("https://localhost:443/api/sagra",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({IdSagra:o(A).idSagra})}),n=await e.text();if(!n){if(e.ok){console.log("Sagra eliminata con successo (risposta vuota)"),await j(),d(k,!1);return}throw new Error(`Errore durante l'eliminazione della sagra: ${e.status}`)}console.log("Risposta dal server (raw):",n);let t;try{t=JSON.parse(n)}catch(s){if(console.error("Errore nel parsing JSON:",s),e.ok){console.log("Sagra eliminata con successo (risposta non-JSON)"),await j(),d(k,!1);return}throw new Error(`Errore nel parsing della risposta: ${n.substring(0,100)}...`)}if(!e.ok){const s=t&&t.message?t.message:`Errore durante l'eliminazione della sagra: ${e.status}`;throw new Error(s)}console.log("Sagra eliminata con successo:",t),await j(),d(k,!1)}catch(a){console.error("Errore nell'eliminazione della sagra:",a),d(x,a.message)}}function la(a){d(A,a),d(c,{nome:a.nomeSagra,descrizione:a.descrizione,luogo:a.luogo}),d(C,!0)}function ca(a){d(A,a),d(k,!0)}function da(){d(c,{nome:"",descrizione:"",luogo:""})}Da(()=>{const a=D("authToken"),e=D("userRole");if(!a||e!=="Organizzatore"){window.location.href="/Home";return}j()}),Na();var H=qa();xa(a=>{Ea.title="Le Mie Sagre | Village Festival"});var P=Sa(H),F=i(P),va=l(i(F),2);r(F);var V=l(F,2);{var ua=a=>{var e=ja(),n=i(e,!0);r(e),G(()=>q(n,o(x))),S(a,e)};$(V,a=>{o(x)&&a(ua)})}var ga=l(V,2);{var ma=a=>{var e=Oa();S(a,e)},fa=(a,e)=>{{var n=s=>{var v=Ma();S(s,v)},t=s=>{var v=Ja();ka(v,5,()=>o(L),Aa,(f,u)=>{var g=$a(),h=i(g),m=l(i(h),2),_=i(m),w=i(_,!0);r(_);var y=l(_,2),N=i(y,!0);r(y);var O=l(y,2),b=l(i(O),1,!0);r(O),r(m);var X=l(m,2),Y=i(X),Z=i(Y),U=l(Z,2),aa=i(U),wa=l(aa,2);r(U),r(Y),r(X),r(h),r(g),G(()=>{q(w,o(u).nomeSagra),q(N,o(u).descrizione),q(b,o(u).luogo)}),p("click",Z,()=>window.location.href=`/Sagre/Sagra?id=${o(u).idSagra}`),p("click",aa,()=>la(o(u))),p("click",wa,()=>ca(o(u))),S(f,g)}),r(v),S(s,v)};$(a,s=>{o(L).length===0?s(n):s(t,!1)},e)}};$(ga,a=>{o(I)?a(ma):a(fa,!1)})}r(P);var K=l(P,2);{var ba=a=>{var e=La(),n=i(e),t=i(n),s=i(t),v=l(i(s),2);r(s);var f=l(s,2),u=i(f),g=i(u),h=l(i(g),2);ea(h),r(g);var m=l(g,2),_=l(i(m),2);R(_),r(m);var w=l(m,2),y=l(i(w),2);ea(y),r(w);var N=l(w,2),O=i(N);Q(2),r(N),r(u),r(f),r(t),r(n),r(e),p("click",v,()=>d(T,!1)),J(h,()=>o(c).nome,b=>M(c,o(c).nome=b)),J(_,()=>o(c).descrizione,b=>M(c,o(c).descrizione=b)),J(y,()=>o(c).luogo,b=>M(c,o(c).luogo=b)),p("click",O,()=>d(T,!1)),p("submit",u,oa(sa)),S(a,e)};$(K,a=>{o(T)&&a(ba)})}var W=l(K,2);{var pa=a=>{var e=Ta(),n=i(e),t=i(n),s=i(t),v=l(i(s),2);r(s);var f=l(s,2),u=i(f),g=i(u),h=l(i(g),2);R(h),r(g);var m=l(g,2),_=l(i(m),2);R(_),r(m);var w=l(m,2),y=l(i(w),2);R(y),r(w);var N=l(w,2),O=i(N);Q(2),r(N),r(u),r(f),r(t),r(n),r(e),p("click",v,()=>d(C,!1)),J(h,()=>o(c).nome,b=>M(c,o(c).nome=b)),J(_,()=>o(c).descrizione,b=>M(c,o(c).descrizione=b)),J(y,()=>o(c).luogo,b=>M(c,o(c).luogo=b)),p("click",O,()=>d(C,!1)),p("submit",u,oa(()=>ia(o(A)))),S(a,e)};$(W,a=>{o(C)&&o(A)&&a(pa)})}var ha=l(W,2);{var _a=a=>{var e=Ca(),n=i(e),t=i(n),s=i(t),v=l(i(s),2);r(s);var f=l(s,2),u=l(i(f),2),g=i(u);r(u),Q(2),r(f);var h=l(f,2),m=i(h),_=l(m,2);r(h),r(t),r(n),r(e),G(()=>q(g,`Stai per eliminare la sagra "${o(A).nomeSagra??""}"`)),p("click",v,()=>d(k,!1)),p("click",m,()=>d(k,!1)),p("click",_,na),S(a,e)};$(ha,a=>{o(k)&&o(A)&&a(_a)})}p("click",va,()=>{da(),d(T,!0)}),S(B,H),za()}function Xa(B){Ra(B,{})}export{Xa as component};
